var xmlHandler = require('./xmlHandler');
var imagePuller = require('./imagePuller');
var svg_to_png = require('./svg-to-png');


var urls =     ['http://pbs.twimg.com/profile_images/3731697111/ee6518fd88106f8b1865e724f532f555_normal.jpeg','http://pbs.twimg.com/profile_images/2336358907/xmv1bs5mavum7b422mba_normal.jpeg','http://pbs.twimg.com/profile_images/418254172102733824/unwcxpnK_normal.jpeg','http://pbs.twimg.com/profile_images/2606867391/49jwdkfdhy2x27tn9vyk_normal.jpeg','http://pbs.twimg.com/profile_images/416606308914065408/9_0_Wxab_normal.jpeg','http://pbs.twimg.com/profile_images/692562980/Salil_no_specs_gmail_normal.jpg','http://pbs.twimg.com/profile_images/378800000474786957/fc47ca82be40f137ee62a5c79dc3bb1a_normal.png','http://pbs.twimg.com/profile_images/413367742729703424/ie2dP2x__normal.png','http://pbs.twimg.com/profile_images/1417001519/DSCN4377_resize_normal.JPG','http://pbs.twimg.com/profile_images/378800000668308748/7eb0e680e0c332e3fb70c9b8611e1d84_normal.jpeg','http://pbs.twimg.com/profile_images/3632580328/56fe8b56abdc5ecb1274b582b77dc821_normal.png','http://pbs.twimg.com/profile_images/414864737625583616/GRt0iEXx_normal.jpeg','http://abs.twimg.com/sticky/default_profile_images/default_profile_5_normal.png','http://pbs.twimg.com/profile_images/378800000737675554/8afa204eb265104ffb7b783d84e9022d_normal.jpeg','http://pbs.twimg.com/profile_images/378800000541332287/1b6d7ccf51cab76954d2f5957479dcfa_normal.png','http://abs.twimg.com/sticky/default_profile_images/default_profile_5_normal.png','http://pbs.twimg.com/profile_images/2242948130/199024_1958533928048_1383757111_2303531_7493470_n_normal.jpg','http://pbs.twimg.com/profile_images/413719756181491712/XYk7U9DY_normal.jpeg','http://pbs.twimg.com/profile_images/3683884092/7408a3c233e05f5c31c3de4e848a9f87_normal.jpeg','http://pbs.twimg.com/profile_images/3755210806/6719263f673750b2035d16f38eb89cfd_normal.png','http://pbs.twimg.com/profile_images/749993409/Image340_normal.jpg','http://pbs.twimg.com/profile_images/1411222764/infinity_normal.jpg','http://pbs.twimg.com/profile_images/3042544576/9c6893231e2e86074a01896e3b7aefdd_normal.jpeg','http://pbs.twimg.com/profile_images/378800000576414815/03a7aba23a1fcdf88842dbe431cf8d79_normal.jpeg','http://pbs.twimg.com/profile_images/378800000501535623/134284e5240f60afbff0877a59d17199_normal.jpeg','http://pbs.twimg.com/profile_images/2440773060/t6202uqmae7uv20x6jy8_normal.jpeg','http://pbs.twimg.com/profile_images/378800000037910086/952a187e3fe9443a8c71c04aa6b1be55_normal.jpeg','http://pbs.twimg.com/profile_images/378800000501569239/582cf52fba8a5d79ce56d923d894ec51_normal.jpeg','http://pbs.twimg.com/profile_images/1633621735/gi-275_normal.png','http://pbs.twimg.com/profile_images/1093846244/Misiek_normal.jpg','http://pbs.twimg.com/profile_images/378800000239538478/58f4db56063c3cbfab12a24530d95e1e_normal.jpeg','http://abs.twimg.com/sticky/default_profile_images/default_profile_4_normal.png','http://pbs.twimg.com/profile_images/378800000108304583/db323ae32dda7d6d8d290a86b17c7361_normal.jpeg','http://pbs.twimg.com/profile_images/2864327296/180e54eb8d9ecde9f1cabc899aee1ff8_normal.jpeg','http://abs.twimg.com/sticky/default_profile_images/default_profile_6_normal.png','http://pbs.twimg.com/profile_images/3107410382/a299b7122a8142aa568fcd2f3ed3aea3_normal.png','http://pbs.twimg.com/profile_images/378800000015508728/42667c79398bf38ed061b293d8265e5c_normal.png','http://pbs.twimg.com/profile_images/378800000792591146/b3c33c67562aa03dfe7797a1f63729ce_normal.jpeg','http://abs.twimg.com/sticky/default_profile_images/default_profile_1_normal.png','http://pbs.twimg.com/profile_images/3466634770/646bc91f21bf9c1c17605aed9ef4b44e_normal.jpeg','http://pbs.twimg.com/profile_images/2442327621/1hezn7n5bqczs5al58g7_normal.jpeg','http://pbs.twimg.com/profile_images/378800000290078177/9a65eb03ed92d4bc0b8ecaea3ac0b6b2_normal.jpeg','http://pbs.twimg.com/profile_images/378800000008795249/ddf80f634739c2b63a65e033dbd8cdbc_normal.jpeg','http://pbs.twimg.com/profile_images/1532058335/Linux_normal.png','http://pbs.twimg.com/profile_images/3432477658/b4cfe218d6f552674588d2a6fd4fb7a1_normal.png','http://pbs.twimg.com/profile_images/3609491522/388703f14207ddbb9d4f7e56f6644835_normal.png','http://pbs.twimg.com/profile_images/2907286960/eec8f24c87bc62ea59afeb821d234760_normal.png','http://pbs.twimg.com/profile_images/1908852623/David-Guetta_normal.jpg','http://pbs.twimg.com/profile_images/1673714373/prashant_acharekar_1_normal.jpg','http://pbs.twimg.com/profile_images/3260375517/3c3557ca63d7e92c6a7dfeba3429317d_normal.jpeg','http://pbs.twimg.com/profile_images/378800000792095167/67e97ff24dc12e92e5f8caa86aacdf73_normal.png','http://pbs.twimg.com/profile_images/378800000151090419/cda200219d63405671e6dc99e5c3b3e0_normal.jpeg','http://pbs.twimg.com/profile_images/2679175639/76d1d56462dce2cfe0e111c9cf3db28d_normal.jpeg','http://pbs.twimg.com/profile_images/378800000028304783/16d736cc3ca27d956f8020ae40a657ea_normal.jpeg','http://pbs.twimg.com/profile_images/378800000259067946/e3375d3876bf6e0bcd3da2997b7d80ea_normal.png','http://pbs.twimg.com/profile_images/378800000638316198/93cd8c20598b806804e9748713e1d707_normal.jpeg','http://pbs.twimg.com/profile_images/3400243758/d87b8d959e7d312c88f037856b8593d3_normal.jpeg','http://pbs.twimg.com/profile_images/2578810205/4gz2dhu3q2y5qmc7jgjn_normal.png','http://pbs.twimg.com/profile_images/2922010887/3826025f2b7534cfec107714458eb732_normal.jpeg','http://pbs.twimg.com/profile_images/415379520414171136/h6Ug6Qhb_normal.jpeg','http://pbs.twimg.com/profile_images/2947745990/e8e01c1f3f84159a3fb10235f0bb6f51_normal.png','http://pbs.twimg.com/profile_images/378800000101064970/92f2de3ac3e340b489b382a39f6f741b_normal.jpeg','http://pbs.twimg.com/profile_images/3177681618/191e349b6501ade110b662ed6264f05a_normal.jpeg','http://pbs.twimg.com/profile_images/3549691865/1ac5c22245ac33a160a8a49d80085388_normal.jpeg','http://pbs.twimg.com/profile_images/409920988/mint_photo_normal.jpg','http://pbs.twimg.com/profile_images/772364732/12012010156_normal.jpg','http://pbs.twimg.com/profile_images/127105431/Lolly2_normal.jpg','http://pbs.twimg.com/profile_images/2766636718/153d5f321674236212b3267d5fd9262c_normal.jpeg','http://pbs.twimg.com/profile_images/1558952027/P110911_22.01_normal.jpg','http://pbs.twimg.com/profile_images/723188419/Image008_normal.jpg','http://pbs.twimg.com/profile_images/1323625965/Abhi008_normal.jpg','http://pbs.twimg.com/profile_images/2275651413/Fri_Mar_09_12-38-46_-_Copy_normal.jpg','http://pbs.twimg.com/profile_images/3513762122/7d32360c9f2dac3a5f47e044263c31aa_normal.jpeg','http://pbs.twimg.com/profile_images/632554364/IMG0132A_normal.jpg','http://abs.twimg.com/sticky/default_profile_images/default_profile_3_normal.png','http://pbs.twimg.com/profile_images/378800000637691154/bfe9fa0cbb01c9f0d9ca640173475b1c_normal.jpeg','http://abs.twimg.com/sticky/default_profile_images/default_profile_4_normal.png','http://pbs.twimg.com/profile_images/2286914865/rynii7tmscuzpx3ibyoa_normal.png','http://pbs.twimg.com/profile_images/1680473383/1789144390213_normal.gif','http://pbs.twimg.com/profile_images/1758346186/bigAngry_-_Copy_normal.png','http://pbs.twimg.com/profile_images/1719138678/335516_2716779752895_1059010329_2934345_1226939200_o_normal.jpg','http://pbs.twimg.com/profile_images/1324738361/2mangoes_ico_128x128_normal.png','http://pbs.twimg.com/profile_images/210542221/anand_chhatpar_3_normal.JPG','http://pbs.twimg.com/profile_images/1452692736/1311223083_jc4_01_normal.jpg','http://abs.twimg.com/sticky/default_profile_images/default_profile_0_normal.png','http://abs.twimg.com/sticky/default_profile_images/default_profile_3_normal.png','http://pbs.twimg.com/profile_images/3266790970/96139737e4570441c0c755093060248f_normal.jpeg','http://abs.twimg.com/sticky/default_profile_images/default_profile_5_normal.png','http://pbs.twimg.com/profile_images/1500312325/IMAG0089_normal.jpg','http://pbs.twimg.com/profile_images/1490018927/34_normal.jpg','http://abs.twimg.com/sticky/default_profile_images/default_profile_6_normal.png','http://pbs.twimg.com/profile_images/1467422927/music_abstract_normal.jpg','http://pbs.twimg.com/profile_images/1909897449/426032_10150668175161358_669911357_9141059_980842632_n_normal.jpg','http://pbs.twimg.com/profile_images/1900593388/rambw_normal.jpg','http://abs.twimg.com/sticky/default_profile_images/default_profile_6_normal.png','http://pbs.twimg.com/profile_images/1384161900/IMAGE_109_normal.jpg','http://abs.twimg.com/sticky/default_profile_images/default_profile_2_normal.png','http://pbs.twimg.com/profile_images/1284946986/156912_112050772201844_100001907644674_92277_1478969_n_normal.jpg','http://pbs.twimg.com/profile_images/378800000802373390/a35727ecc874e08125c0d46bc9d19b11_normal.jpeg','http://pbs.twimg.com/profile_images/1276912102/156912_112050772201844_100001907644674_92277_1478969_n_normal.jpg','http://pbs.twimg.com/profile_images/1264557288/36433_107944712589281_100001212585008_61333_914458_n_normal.jpg','http://pbs.twimg.com/profile_images/1263327945/Photo-0226_-_Copy_normal.jpg','http://pbs.twimg.com/profile_images/1252038542/sivaji201_normal.jpg','http://pbs.twimg.com/profile_images/378800000642081458/4a470d79677130fe505d08e81c88d1b9_normal.jpeg','http://pbs.twimg.com/profile_images/3594961707/6a6cebb8064b00fd7740e9943dbc9a7d_normal.jpeg','http://pbs.twimg.com/profile_images/1151343666/Orangelogo_normal.jpg','http://pbs.twimg.com/profile_images/1140796918/s_b6245198338bfe3f8816be54344b41e5_normal.jpg','http://pbs.twimg.com/profile_images/416929690532593664/cr1_d7At_normal.jpeg','http://pbs.twimg.com/profile_images/1136130263/Iphone_normal.jpg','http://pbs.twimg.com/profile_images/3465428039/b626898a9c46f4180f321c8de139ded2_normal.jpeg','http://abs.twimg.com/sticky/default_profile_images/default_profile_0_normal.png','http://abs.twimg.com/sticky/default_profile_images/default_profile_2_normal.png','http://pbs.twimg.com/profile_images/650032972/smstweet_normal.png','http://abs.twimg.com/sticky/default_profile_images/default_profile_2_normal.png','http://pbs.twimg.com/profile_images/943035610/r2_normal.jpg','http://pbs.twimg.com/profile_images/378800000065308659/080ec71057f8ba2703d950a071d2bd80_normal.jpeg'];

//imagePuller.fetchImage(urls);
var getImageData = function(callback) {
    /*var imageUrls = [];
    var index = 0;
    for(var i = 0; i < 90 ; i++){
        imageUrls.push(urls[index++ % 2]);
    }
*/    
    imagePuller.fetchImage(urls, function(results){
        createSvg(results, callback);    
    });
    //createSvg([], callback);
};

var createSvg = function(results, callback) {
    var svgCreator = new xmlHandler.svg();
    var startX = 0;
    var startY = 0;
    var width = 50;
    var height = 50;
    var canvasWidth = 50 * 12;
    var canvasHeight = 50 * 13;
    var result = results[0] || results[1];
    console.log(results.length);
    for(var i = 0; i < results.length; i++ ) {
        if(results[i]) {
            svgCreator.createImageElement(results[i], startX, startY, width, height);
            startX += width;
            if(startX >= canvasWidth) {
                startX = 0;
            }
            if(startX === 0) {
                startY += height;
            }    
        } else {
            console.log(results[i]);
        }
                
    }
    
    createImage(svgCreator.getSvg().toString(), callback);
    
};

var createImage = function(svg, callback) {
    callback(svg_to_png.createImage(svg));
};

var dynoImage = function(callback) {
    getImageData(callback);
    /*getImageUrls(callback);*/
};



exports.dynoImage = dynoImage;

/*['http://abs.twimg.com/sticky/default_profile_images/default_profile_5_normal.png','http://pbs.twimg.com/profile_images/378800000253476230/dae1048c98f6c09680ef771d733fe2f8_normal.jpeg','http://pbs.twimg.com/profile_images/378800000576414815/03a7aba23a1fcdf88842dbe431cf8d79_normal.jpeg','http://abs.twimg.com/sticky/default_profile_images/default_profile_2_normal.png','http://pbs.twimg.com/profile_images/2517575106/6gxgx1qkhge44zrple3l_normal.jpeg','http://pbs.twimg.com/profile_images/378800000269231868/e3366eca071debe76f35708195b6e21c_normal.jpeg','http://pbs.twimg.com/profile_images/378800000600226383/0b5089a8eed38f35a4faa6db1dfc5cef_normal.jpeg','http://pbs.twimg.com/profile_images/378800000678102489/4d5c652e7ef7a2b7a11f4e5edfe27812_normal.jpeg','http://pbs.twimg.com/profile_images/3133561146/9a0fb1ddb1f259ae5171e4a71687f063_normal.jpeg','http://pbs.twimg.com/profile_images/378800000039696938/90b0f121cf4de65838f6fc6aabeabb9b_normal.jpeg','http://pbs.twimg.com/profile_images/378800000281418598/656a507420e452634bbb3270e69e70f7_normal.jpeg','http://pbs.twimg.com/profile_images/3717369400/59f7b496dd2691f75fd0bda4e1f58034_normal.jpeg','http://pbs.twimg.com/profile_images/3027579897/3a57a4f79dbaaaeeb3330dc0cbcd7a3d_normal.jpeg','http://pbs.twimg.com/profile_images/3130580756/ad4e52b7fa21e3561103ed88ee305a1c_normal.jpeg','http://pbs.twimg.com/profile_images/378800000516670778/bf823175976054b14464e083580efdc6_normal.jpeg','http://pbs.twimg.com/profile_images/415370237920309248/O-K-5KL1_normal.jpeg','http://pbs.twimg.com/profile_images/3300381382/fa2eb37485ad3830e189e8f27d155b50_normal.jpeg','http://pbs.twimg.com/profile_images/2146554111/mspfeed_normal.png','http://pbs.twimg.com/profile_images/2988634596/883b13ba07b994af6944655db8e92418_normal.jpeg','http://pbs.twimg.com/profile_images/2881628022/2fa9871c20b7a4f6adf06e298f510b44_normal.jpeg','http://pbs.twimg.com/profile_images/2852445263/912f161037b21da34e118cecbeef8c91_normal.png','http://pbs.twimg.com/profile_images/378800000758419327/fdb265917b06e621611577a9cec23c58_normal.png','http://pbs.twimg.com/profile_images/685833690/profile_pic_normal.jpg','http://pbs.twimg.com/profile_images/697244882/1953_CRW_4669_normal.jpg','http://pbs.twimg.com/profile_images/378800000040828491/5592b71f26f3f76445eacb35fc137304_normal.png','http://pbs.twimg.com/profile_images/1416968129/Indian_totempole_normal.jpg','http://pbs.twimg.com/profile_images/1192337560/plexpod_slug_normal.png','http://pbs.twimg.com/profile_images/2661533226/a98e71f098c0edb62d941566385a1832_normal.jpeg','http://abs.twimg.com/sticky/default_profile_images/default_profile_4_normal.png','http://pbs.twimg.com/profile_images/378800000261227041/865cf95d5388131a21d70ae56055df1c_normal.jpeg']*/